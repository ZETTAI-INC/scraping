# 求人情報自動収集システム - デスクトップ版

タウンワークから求人情報を自動収集し、SQLiteデータベースに保存、フィルタリング後にCSV出力できるWindowsデスクトップアプリケーションです。

## 機能一覧

### 1. 求人情報収集（タウンワーク）
- キーワード検索
- 地域指定
- 複数ページの自動取得
- 並列処理による高速化

### 2. データベース管理（SQLite）
- 求人情報の永続化
- 重複チェック・更新管理
- 新着フラグ管理

### 3. フィルタリング機能
- 電話番号重複削除
- 従業員数フィルタ（1,001人以上除外）
- 派遣・紹介キーワード除外
- 業界フィルタ（広告・メディア等）
- 勤務地フィルタ（沖縄除外）
- 電話番号プレフィックスフィルタ

### 4. CSV出力
- UTF-8 BOM付き（Excel対応）
- 日本語ヘッダー
- フィルタ適用前/後の出力

### 5. 新着監視・スケジューラー
- 定期自動クローリング（30分〜24時間間隔）
- 実行時間帯制限
- 新着通知

## インストール

### 必要環境
- Python 3.9以上
- Windows 10/11（exe版）

### セットアップ

```bash
# リポジトリをクローン
git clone https://github.com/your-repo/job-collector.git
cd job-collector

# 仮想環境を作成
python -m venv venv

# 仮想環境を有効化
# Windows:
venv\Scripts\activate
# Mac/Linux:
source venv/bin/activate

# 依存パッケージをインストール
pip install -r requirements.txt

# Playwrightのブラウザをインストール
playwright install chromium
```

## 使い方

### デスクトップGUIの起動

```bash
python main.py
```

### CLI版の実行

```bash
python -m src.services.crawl_service
```

## ディレクトリ構成

```
job-collector/
├── main.py                 # メインエントリーポイント
├── requirements.txt        # 依存パッケージ
├── build_exe.spec         # PyInstaller設定
├── build.bat              # Windowsビルドスクリプト
├── build.sh               # Mac/Linuxビルドスクリプト
│
├── src/
│   ├── database/          # データベース層
│   │   ├── db_manager.py      # SQLite管理
│   │   └── job_repository.py  # 求人リポジトリ
│   │
│   ├── filters/           # フィルタリング
│   │   └── job_filter.py      # 除外ルール実装
│   │
│   ├── services/          # ビジネスロジック
│   │   ├── crawl_service.py   # クロールサービス
│   │   ├── csv_exporter.py    # CSV出力
│   │   └── scheduler_service.py # スケジューラー
│   │
│   └── gui/               # デスクトップGUI
│       └── main_window.py     # メインウィンドウ
│
├── scrapers/              # スクレイパー（既存）
│   ├── base_scraper.py
│   └── townwork.py
│
├── config/                # 設定ファイル
│   └── selectors.json
│
├── data/
│   ├── db/               # SQLiteデータベース
│   ├── output/           # CSV出力先
│   └── logs/             # ログファイル
│
└── utils/                 # ユーティリティ（既存）
```

## exe化（Windows向け）

```bash
# Windows
build.bat

# Mac/Linux
./build.sh
```

出力先: `dist/JobCollector.exe`

## フィルタリングルール

CSV出力時に以下の条件で自動フィルタリングされます：

1. **電話番号重複削除**: 同一電話番号の求人は1件のみ保持
2. **従業員数フィルタ**: 1,001人以上の企業を除外
3. **キーワードフィルタ**: 人材派遣、人材紹介等を含む企業を除外
4. **業界フィルタ**: 広告、メディア、出版業界を除外
5. **勤務地フィルタ**: 沖縄県の求人を除外
6. **電話番号プレフィックス**: 0120, 050, 沖縄局番等を除外

## CSV出力形式

```csv
媒体名,求人番号,会社名,会社名カナ,郵便番号,住所1,住所2,住所3,電話番号,FAX番号,職種,雇用形態,給与,勤務時間,休日,就業場所,事業内容,仕事内容,応募資格,採用人数,担当者名,担当者メールアドレス,ページURL,従業員数,取得日時
```

- エンコーディング: UTF-8 (BOM付き)
- 区切り文字: カンマ
- 改行コード: CRLF

## 開発者向け情報

### タウンワークURL生成パターン（重要：先祖返り防止用）

タウンワークの検索URLは以下の2パターンがあります。**必ずカテゴリ検索を優先**してください。

#### 1. カテゴリ検索URL（推奨）

キーワードが職種カテゴリにマッピングされている場合に使用：

```
https://townwork.net/prefectures/{都道府県ローマ字}/job_search/oc-{大カテゴリ}/omc-{小カテゴリ}/?sc=new
```

例：
- 石川+SE → `https://townwork.net/prefectures/ishikawa/job_search/oc-013/omc-0102/?sc=new`
- 東京+事務 → `https://townwork.net/prefectures/tokyo/job_search/oc-006/?sc=new`

#### 2. キーワード検索URL（フォールバック）

カテゴリにマッピングがない場合のみ使用：

```
https://townwork.net/job_search/kw/{都道府県名}+{キーワード}/?sc=new
```

例：
- 福岡+システム開発 → `https://townwork.net/job_search/kw/福岡県+システム開発/?sc=new`

#### 重要なパラメータ

| パラメータ | 説明 |
|-----------|------|
| `sc=new` | **新着順ソート（必須）** |
| `page=N` | ページ番号（2ページ目以降） |

#### 職種カテゴリコード一覧

| コード | 職種 | 主なキーワード |
|--------|------|---------------|
| oc-001 | 飲食・フードサービス | 飲食, 調理, ホール, キッチン |
| oc-002 | 営業・販売 | 営業, 販売, 接客, コンビニ(omc-0014) |
| oc-003 | 旅行・レジャー・イベント | イベント, レジャー, 旅行 |
| oc-004 | 倉庫・物流管理 | 物流, 倉庫, 軽作業 |
| oc-005 | 警備・保安 | 警備 |
| oc-006 | 経営・事業企画・人事・事務 | 事務, 経理, 総務, データ入力(omc-0040) |
| oc-007 | マーケティング・広告・宣伝 | マーケティング, 企画 |
| oc-008 | 保育士・教員・講師 | 保育, 教育, 講師 |
| oc-009 | ドライバー・引越し・配送 | ドライバー, 配送 |
| oc-010 | 介護・福祉 | 介護 |
| oc-011 | 医療・看護師・薬剤師 | 医療, 看護, 薬剤師 |
| oc-012 | メディア・クリエイター | デザイン |
| oc-013 | IT・Web・ゲームエンジニア | SE(omc-0102), プログラマー(omc-0103), IT, エンジニア |
| oc-016 | 清掃・美化 | 清掃 |
| oc-017 | 美容師 | 美容 |
| oc-018 | 建設・土木・施工 | 建設, 土木 |
| oc-019 | 製造・工場 | 製造, 工場 |

#### 都道府県ローマ字一覧

実装は `scrapers/townwork.py` の `PREF_ROMAN` を参照。

例：北海道=hokkaidou, 東京=tokyo, 大阪=oosaka, 石川=ishikawa, 京都=kyouto

## ライセンス

MIT License

## 注意事項

- 各求人媒体の利用規約を確認の上、ご利用ください
- 過度なアクセスは避け、適切な間隔を空けてください
- 取得したデータの取り扱いは個人情報保護法に準拠してください

## 更新履歴

### 2025-12-03
- **タウンワーク: カテゴリ検索対応**
  - 職種キーワード（SE、事務、介護など）を職種カテゴリコード（oc-013等）に変換
  - 都道府県をローマ字（ishikawa等）に変換してカテゴリ検索URLを生成
  - カテゴリにないキーワードはフリーキーワード検索にフォールバック
- **タウンワーク: 新着順ソート対応**
  - 全検索URLに `sc=new` パラメータを追加
- **ドキュメント: URL生成パターンを追記**
  - 先祖返り防止のため、タウンワークのURL形式を詳細にドキュメント化
