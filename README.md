# 求人情報自動収集システム - タウンワーク & Indeed

<div align="center">

![Python](https://img.shields.io/badge/Python-3.9%2B-blue?logo=python&logoColor=white)
![PyQt6](https://img.shields.io/badge/PyQt6-GUI-41CD52?logo=qt&logoColor=white)
![Playwright](https://img.shields.io/badge/Playwright-1.40%2B-green?logo=playwright&logoColor=white)
![SQLite](https://img.shields.io/badge/SQLite-Database-003B57?logo=sqlite&logoColor=white)
![License](https://img.shields.io/badge/License-Educational-yellow)

**タウンワーク・Indeedから効率的に求人データを収集するためのデスクトップアプリケーション**

[クイックスタート](#クイックスタート) • [機能](#主な機能) • [使い方](#使い方)

</div>

---

## 更新履歴

### 2025-11-28 - 大型アップデート

#### Indeed対応
- **Indeed Japan (jp.indeed.com) スクレイピングに対応**(調整中） 
- タウンワークと同様に都道府県 × 職種での検索が可能
- GUI上でタウンワーク/Indeedを選択して同時検索可能

#### 詳細情報取得機能
- **タウンワークの詳細ページから以下の情報を自動取得**:
  - 住所
  - 電話番号
  - 事業内容
  - 仕事内容
  - 掲載日
- **並列処理による高速化**: 最大3並列で詳細ページを取得
- **重複スキップ**: 同一求人ID（job_id）の詳細取得をスキップして効率化

#### カテゴリコードの修正
- **タウンワークの職種カテゴリコードを全面的に修正**
- 以前の設定では「営業」を選択すると「レジャー」カテゴリが検索されるバグがあった
- 正しいカテゴリコード（oc-XXX）とサブカテゴリコード（omc-XXXX）にマッピング

**修正された主なカテゴリ:**

| キーワード | 旧設定（誤り） | 新設定（正しい） |
|------------|----------------|------------------|
| 営業 | oc-003/ (レジャー) | oc-002/omc-0011/ (営業) |
| IT | oc-001/ (飲食) | oc-013/ (IT・Web・ゲームエンジニア) |
| 事務 | oc-002/ (営業・販売) | oc-006/ (経営・事業企画・人事・事務) |
| 製造 | oc-005/ (警備) | oc-019/ (製造・工場) |

---

## 目次

- [クイックスタート](#クイックスタート)
- [重要な注意事項](#重要な注意事項)
- [主な機能](#主な機能)
- [セットアップ](#セットアップ)
- [使い方](#使い方)
- [プロジェクト構造](#プロジェクト構造)
- [トラブルシューティング](#トラブルシューティング)
- [今後の開発](#今後の開発)
- [ライセンス](#ライセンス)

---

## クイックスタート

### 簡単起動（Windows）- 推奨

**初回セットアップ手順:**

1. `setup.bat` をダブルクリック → セットアップ完了まで待つ
2. `start.bat` をダブルクリック → アプリが起動！

**2回目以降:**

`start.bat` をダブルクリックするだけ！

> **注意**: Pythonがインストールされていない場合は、自動的にPython 3.11をダウンロード・インストールします。インストール後は一度ウィンドウを閉じて、再度バッチファイルを実行してください。

### バッチファイル一覧

| ファイル | 用途 | 説明 |
|----------|------|------|
| `setup.bat` | **初回必須** | Python確認 + 依存パッケージ + Playwrightブラウザをインストール |
| `start.bat` | アプリ起動 | アプリケーションを起動 |

### コマンドラインから起動

```bash
# 1. 依存パッケージのインストール
pip install playwright pandas openpyxl PyQt6 APScheduler beautifulsoup4 lxml aiofiles python-dotenv pydantic

# 2. Playwrightブラウザのインストール
playwright install chromium

# 3. アプリケーション起動
python main.py
```

PyQt6ベースのデスクトップGUIが起動します。

---

## 重要な注意事項

> **警告**: このシステムは**技術検証・学習目的**で開発されています。

| ルール | 詳細 |
|--------|------|
| 利用規約 | 各サイトの利用規約を必ず確認してください |
| 商用利用 | 避けてください |
| アクセス頻度 | 適切に制限してください |
| robots.txt | 尊重してください |

---

## 主な機能

### 対応サイト

| サイト | 対応状況 | 備考 |
|--------|----------|------|
| タウンワーク | ✅ 対応 | 詳細ページからの追加情報取得に対応 |
| Indeed Japan | ✅ 対応 | ボット検出対策のため headed モードで動作 |

### 検索機能

| 機能 | 説明 |
|------|------|
| **地域選択** | 47都道府県から選択可能、地方単位での一括選択に対応 |
| **キーワード検索** | IT、事務、営業など40種類以上のプリセットキーワード |
| **カスタムキーワード** | 任意のキーワードを追加可能 |
| **並列処理** | 非同期処理による高速スクレイピング（1〜12並列） |
| **サイト選択** | タウンワーク / Indeed を選択して検索 |

### 取得データ項目

#### 一覧ページから取得
- 会社名
- 職種
- 勤務地
- 給与
- 雇用形態
- 求人ページURL

#### 詳細ページから取得（タウンワーク）
- 住所
- 電話番号
- 事業内容
- 仕事内容
- 掲載日
- 郵便番号
- 勤務時間
- 休日休暇

### フィルタ機能

| フィルタ | 説明 |
|----------|------|
| **電話番号重複削除** | 同一電話番号の求人を1件に集約 |
| **大企業除外** | 従業員数1,001人以上の企業を除外（しきい値変更可能） |
| **派遣・紹介除外** | 人材派遣、人材紹介等を含む企業を除外 |
| **業界フィルタ** | 広告、メディア、出版業界を除外 |
| **勤務地フィルタ** | 沖縄県の求人を除外 |
| **電話番号プレフィックス** | 0120、050、沖縄局番等を除外 |

### データ管理

| 機能 | 説明 |
|------|------|
| **SQLiteデータベース** | 取得した求人データを永続化 |
| **重複検出** | URL・求人IDによる重複排除 |
| **CSVエクスポート** | フィルタ前・後のデータをCSV出力（UTF-8 BOM付き） |
| **統計表示** | DB累計件数、新着件数、DBサイズを表示 |

### 技術的特徴

- **PyQt6 GUI** - ネイティブなデスクトップアプリケーション
- **Playwright** - 高速で安定したブラウザ自動化
- **Stealth設定** - ヘッドレスブラウザ検出回避
- **非同期処理** - UIをブロックせずにバックグラウンド実行
- **リアルタイム進捗** - 経過時間、取得件数、保存件数をリアルタイム表示
- **並列詳細取得** - セマフォで同時接続数を制限しつつ並列処理

---

## セットアップ

### 必要要件

- Python 3.9以上
- Windows / macOS / Linux

### インストール

```bash
# 1. 依存パッケージのインストール
pip install -r requirements.txt

# 2. Playwrightブラウザのインストール
playwright install chromium

# 3. セットアップ検証（オプション）
python verify_setup.py
```

---

## 使い方

### アプリケーション起動

#### バッチファイルで起動（推奨・Windows）

ターミナル操作不要で、ダブルクリックだけで起動できます。

| ファイル | 用途 | 説明 |
|----------|------|------|
| `setup.bat` | 初回セットアップ | Python環境の確認、依存パッケージとPlaywrightブラウザのインストール |
| `start.bat` | アプリ起動 | アプリケーションを起動（未セットアップの場合は自動でセットアップ） |

**手順:**
1. 初回は `setup.bat` をダブルクリックしてセットアップ
2. 以降は `start.bat` をダブルクリックするだけ

#### コマンドラインで起動

```bash
python main.py
```

### 画面構成

アプリケーションは左右2パネル構成です：

**左パネル（設定）**
- **地域選択タブ**: 都道府県を選択（地方単位での一括選択可能）
- **キーワードタブ**: 検索キーワードを選択（カスタムキーワード追加可能）
- **フィルタ・オプションタブ**: フィルタ設定と検索オプション
  - **媒体選択**: タウンワーク / Indeed のチェックボックス

**右パネル（結果）**
- **検索結果タブ**: 取得した求人一覧
- **フィルタ結果タブ**: フィルタ適用後の求人一覧

### 基本的な操作手順

1. **地域を選択**: 左パネルの「地域選択」タブで都道府県を選択
2. **キーワードを選択**: 「キーワード」タブで検索キーワードを選択
3. **媒体を選択**: 「フィルタ・オプション」タブでタウンワーク/Indeedを選択
4. **検索実行**: 「検索実行」ボタンをクリック
5. **フィルタ適用**: 検索結果タブで「フィルタ適用」ボタンをクリック
6. **CSVエクスポート**: 必要に応じてCSV出力

### 検索オプション

| オプション | 説明 | デフォルト |
|------------|------|------------|
| 最大ページ数 | 各検索条件で取得するページ数 | 5 |
| 並列数 | 同時に処理する数 | 5 |

---

## プロジェクト構造

```
scraping/
├── main.py                      # エントリーポイント（GUIを起動）
├── requirements.txt             # 依存パッケージ
│
├── src/                         # メインソースコード
│   ├── gui/
│   │   ├── main_window.py       # PyQt6メインウィンドウ
│   │   └── styles.py            # UIスタイル定義
│   │
│   ├── services/
│   │   ├── crawl_service.py     # クローリングサービス
│   │   └── csv_exporter.py      # CSVエクスポート
│   │
│   ├── database/
│   │   ├── db_manager.py        # データベース管理
│   │   └── job_repository.py    # 求人データリポジトリ
│   │
│   ├── filters/
│   │   └── job_filter.py        # フィルタ処理
│   │
│   └── models/
│       ├── job.py               # 求人モデル
│       └── search_condition.py  # 検索条件モデル
│
├── scrapers/
│   ├── townwork.py              # タウンワークスクレイパー
│   ├── indeed.py                # Indeedスクレイパー
│   └── base_scraper.py          # ベーススクレイパー
│
├── config/
│   └── selectors.json           # サイト別セレクタ・カテゴリコード設定
│
├── utils/
│   ├── stealth.py               # ステルス設定
│   ├── page_utils.py            # ページユーティリティ
│   └── ...                      # その他ユーティリティ
│
└── data/
    ├── db/                      # SQLiteデータベース
    └── output/                  # CSVエクスポート先
```

---

## トラブルシューティング

### バッチファイルをダブルクリックしても一瞬で消える

**原因**: Pythonや依存パッケージが正しくインストールされていない可能性があります。

**解決方法**:
1. まず `setup.bat` をダブルクリックしてセットアップを実行
2. セットアップ完了後、`start.bat` をダブルクリック

### アプリが起動しない

```bash
# PyQt6がインストールされているか確認
pip show PyQt6

# 再インストール
pip install --upgrade PyQt6
```

**または `setup.bat` を再実行してください。**

### データが取得できない

1. **ネットワーク接続を確認**
2. **並列数を減らす**: フィルタ・オプションタブで並列数を1〜3に設定
3. **ヘッドレスモード無効化**: `scrapers/townwork.py`の`headless=False`に変更してブラウザ動作を確認

### Indeed で 0件になる

- Indeedはボット検出が厳しいため、headed モード（ブラウザ表示）で動作します
- 検索条件を絞って再試行してください
- 連続アクセスを避け、時間を空けてください

### Playwrightエラー

```bash
# ブラウザを再インストール
playwright install chromium --with-deps
```

### CSVが文字化けする

- CSVはUTF-8 BOM付きで出力されます
- Excelで開く場合は通常そのまま開けます
- 文字化けする場合は「データ」→「テキストから」でUTF-8を指定

---

## 今後の開発

- [x] Indeed対応
- [x] 詳細ページからの情報取得
- [x] カテゴリコードの修正
- [ ] エラーリトライ機能の強化
- [ ] スケジューラー機能（定期実行）
- [ ] 詳細ログビューア
- [ ] その他求人サイト対応（バイトル等）

---

## ライセンス

このプロジェクトは**教育・研究目的**でのみ使用してください。

商用利用は禁止されています。

---

<div align="center">

**最終更新**: 2025-11-28

---

Made with PyQt6 + Playwright + SQLite

</div>
